{% extends "base.html" %}

{% block title %}Users{% endblock %}

{% block head %}
<style>
  body {
    background: url("{{ url_for('static', filename='images/background.jpg') }}")
                no-repeat center center fixed;
    background-size: cover;
    color: white;
  }

  .page-wrapper {
    min-height: 100vh;
    backdrop-filter: blur(3px);
    background-color: rgba(0, 0, 0, 0.55);
    padding: 40px 0;
  }

  .card {
    background-color: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
  }

  .card h1 {
    color: #212529;
  }

  table th {
    background-color: #f1f3f5;
    color: #212529;
  }

  table td {
    vertical-align: middle;
  }

  .mono {
    font-family: monospace;
    font-size: 0.9rem;
  }

  #searchBox {
    max-width: 350px;
  }
</style>
{% endblock %}

{% block nav %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark w-100">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('home.index') }}">FlaskApp</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto align-items-center gap-2">
        <li class="nav-item">
          <a class="nav-link" href="/dashboardADM">Dashboard</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="/settings/users">Users</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-danger" href="/auth/logout">Logout</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
{% endblock %}

{% block content %}
<div class="page-wrapper">
  <div class="container">

    <div class="card shadow-lg">
      <div class="card-body">

        <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
          <h1 class="mb-0">All Users</h1>

          <div class="d-flex gap-2">
            <a href="?order=cpf"
              class="btn btn-sm {{ 'btn-primary' if order == 'cpf' else 'btn-outline-primary' }}">
              Order by CPF
            </a>

            <a href="?order=name"
              class="btn btn-sm {{ 'btn-primary' if order == 'name' else 'btn-outline-primary' }}">
              Order by Name
            </a>
          </div>

          <input
            type="text"
            id="searchBox"
            class="form-control"
            placeholder="Search by CPF or Name..."
            onkeyup="filterUsers()"
          >
        </div>


        {% if not users %}
          <div class="alert alert-warning mb-0">
            No users found.
          </div>
        {% else %}
          <div class="table-responsive">
            <table id="usersTable" class="table table-striped table-hover align-middle">
              <thead>
                <tr>
                  <th>CPF</th>
                  <th>Name</th>
                  <th>Flights Created</th>
                  <th>Flights Booked</th>
                  <th>Booked IDs</th>
                  <th>Status</th>
                  <th>Privilege</th>
                </tr>
              </thead>
              <tbody>
                {% for u in users %}
                <tr>
                  <td>{{ u.cpf }}</td>
                  <td>{{ u.name }}</td>
                  <td>{{ u.flightsCreated }}</td>
                  <td>{{ u.flightsBooked }}</td>
                  <td class="mono">{{ u.flightsBookedIDS }}</td>
                  <td>
                    <span class="badge bg-secondary">
                      {{ u.status.name }}
                    </span>
                  </td>
                  <td>
                    <span class="badge bg-primary">
                      {{ u.privilege.name }}
                    </span>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% endif %}

      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  function filterUsers() {
    let filter = document.getElementById("searchBox").value.toLowerCase();
    let rows = document.querySelectorAll("#usersTable tbody tr");

    rows.forEach(row => {
      let cpf = row.cells[0].textContent.toLowerCase();
      let name = row.cells[1].textContent.toLowerCase();

      row.style.display =
        cpf.includes(filter) || name.includes(filter) ? "" : "none";
    });
  }
</script>
{% endblock %}
